{"version":3,"file":"useSyntheticBlurEvent.js","sourceRoot":"../../../../src","sources":["hooks/useFocusWithin/useSyntheticBlurEvent.tsx"],"names":[],"mappings":";;AAUA,sDAgEC;;AA1ED,qDAA+B;AAE/B,kEAA0D;AAO1D,uGAAuG;AACvG,SAAgB,qBAAqB,CAAC,MAAgC;IAClE,MAAM,QAAQ,GAAG,KAAK,CAAC,MAAM,CAAQ;QACjC,SAAS,EAAE,KAAK;QAChB,QAAQ,EAAE,IAAI;KACjB,CAAC,CAAC;IAEH,KAAK,CAAC,SAAS,CAAC,GAAG,EAAE;QACjB,MAAM,KAAK,GAAG,QAAQ,CAAC,OAAO,CAAC;QAC/B,OAAO,GAAG,EAAE;YACR,IAAI,KAAK,CAAC,QAAQ,EAAE,CAAC;gBACjB,KAAK,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC;gBAC5B,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC;YAC1B,CAAC;QACL,CAAC,CAAC;IACN,CAAC,EAAE,EAAE,CAAC,CAAC;IAEP,MAAM,WAAW,GAAG,KAAK,CAAC,WAAW,CACjC,CAAC,KAAuB,EAAE,EAAE;QACxB,MAAM,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;QAC5B,IACI,MAAM,YAAY,iBAAiB;YACnC,MAAM,YAAY,gBAAgB;YAClC,MAAM,YAAY,mBAAmB;YACrC,MAAM,YAAY,iBAAiB,EACrC,CAAC;YACC,QAAQ,CAAC,OAAO,CAAC,SAAS,GAAG,IAAI,CAAC;YAElC,MAAM,UAAU,GAAG,CAAC,CAAa,EAAE,EAAE;gBACjC,QAAQ,CAAC,OAAO,CAAC,SAAS,GAAG,KAAK,CAAC;gBAEnC,IAAI,MAAM,CAAC,QAAQ,EAAE,CAAC;oBAClB,MAAM,EAAE,CAAC,IAAI,yCAAmB,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,CAAC;gBACjD,CAAC;gBAED,IAAI,QAAQ,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;oBAC5B,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC;oBACvC,QAAQ,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;gBACrC,CAAC;YACL,CAAC,CAAC;YAEF,qFAAqF;YACrF,mBAAmB;YACnB,MAAM,CAAC,gBAAgB,CAAC,UAAU,EAAE,UAAU,EAAE,EAAC,IAAI,EAAE,IAAI,EAAC,CAAC,CAAC;YAE9D,MAAM,QAAQ,GAAG,IAAI,gBAAgB,CAAC,GAAG,EAAE;gBACvC,IAAI,QAAQ,CAAC,OAAO,CAAC,SAAS,IAAI,MAAM,CAAC,QAAQ,EAAE,CAAC;oBAChD,QAAQ,CAAC,UAAU,EAAE,CAAC;oBACtB,QAAQ,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;oBACjC,MAAM,aAAa,GACf,MAAM,KAAK,QAAQ,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,aAAa,CAAC;oBACtE,MAAM,CAAC,aAAa,CAAC,IAAI,UAAU,CAAC,MAAM,EAAE,EAAC,aAAa,EAAC,CAAC,CAAC,CAAC;oBAC9D,MAAM,CAAC,aAAa,CAChB,IAAI,UAAU,CAAC,UAAU,EAAE,EAAC,aAAa,EAAE,OAAO,EAAE,IAAI,EAAC,CAAC,CAC7D,CAAC;gBACN,CAAC;YACL,CAAC,CAAC,CAAC;YACH,QAAQ,CAAC,OAAO,CAAC,MAAM,EAAE,EAAC,UAAU,EAAE,IAAI,EAAE,eAAe,EAAE,CAAC,UAAU,CAAC,EAAC,CAAC,CAAC;YAC5E,QAAQ,CAAC,OAAO,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzC,CAAC;IACL,CAAC,EACD,CAAC,MAAM,CAAC,CACX,CAAC;IAEF,OAAO,WAAW,CAAC;AACvB,CAAC","sourcesContent":["import * as React from 'react';\n\nimport {SyntheticFocusEvent} from './SyntheticFocusEvent';\n\ninterface State {\n    isFocused: boolean;\n    observer: MutationObserver | null;\n}\n\n// React does not fire onBlur when an element is disabled https://github.com/facebook/react/issues/9142\nexport function useSyntheticBlurEvent(onBlur?: React.FocusEventHandler) {\n    const stateRef = React.useRef<State>({\n        isFocused: false,\n        observer: null,\n    });\n\n    React.useEffect(() => {\n        const state = stateRef.current;\n        return () => {\n            if (state.observer) {\n                state.observer.disconnect();\n                state.observer = null;\n            }\n        };\n    }, []);\n\n    const handleFocus = React.useCallback(\n        (event: React.FocusEvent) => {\n            const target = event.target;\n            if (\n                target instanceof HTMLButtonElement ||\n                target instanceof HTMLInputElement ||\n                target instanceof HTMLTextAreaElement ||\n                target instanceof HTMLSelectElement\n            ) {\n                stateRef.current.isFocused = true;\n\n                const handleBlur = (e: FocusEvent) => {\n                    stateRef.current.isFocused = false;\n\n                    if (target.disabled) {\n                        onBlur?.(new SyntheticFocusEvent('blur', e));\n                    }\n\n                    if (stateRef.current.observer) {\n                        stateRef.current.observer.disconnect();\n                        stateRef.current.observer = null;\n                    }\n                };\n\n                // TS can't resolve correct definition for addEventListener when target is union type\n                // @ts-expect-error\n                target.addEventListener('focusout', handleBlur, {once: true});\n\n                const observer = new MutationObserver(() => {\n                    if (stateRef.current.isFocused && target.disabled) {\n                        observer.disconnect();\n                        stateRef.current.observer = null;\n                        const relatedTarget =\n                            target === document.activeElement ? null : document.activeElement;\n                        target.dispatchEvent(new FocusEvent('blur', {relatedTarget}));\n                        target.dispatchEvent(\n                            new FocusEvent('focusout', {relatedTarget, bubbles: true}),\n                        );\n                    }\n                });\n                observer.observe(target, {attributes: true, attributeFilter: ['disabled']});\n                stateRef.current.observer = observer;\n            }\n        },\n        [onBlur],\n    );\n\n    return handleFocus;\n}\n"]}