{"version":3,"file":"Select.js","sourceRoot":"../../../../src","sources":["components/Select/Select.tsx"],"names":[],"mappings":"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","sourcesContent":["'use client';\n\nimport * as React from 'react';\n\nimport {KeyCode} from '../../constants';\nimport {useControlledState, useFocusWithin, useForkRef, useSelect, useUniqId} from '../../hooks';\nimport type {List} from '../List';\nimport {OuterAdditionalContent} from '../controls/common/OuterAdditionalContent/OuterAdditionalContent';\nimport {errorPropsMapper} from '../controls/utils';\nimport {useMobile} from '../mobile';\nimport type {CnMods} from '../utils/cn';\nimport {filterDOMProps} from '../utils/filterDOMProps';\n\nimport {\n    EmptyOptions,\n    HiddenSelect,\n    SelectControl,\n    SelectFilter,\n    SelectList,\n    SelectPopup,\n} from './components';\nimport {DEFAULT_VIRTUALIZATION_THRESHOLD, selectBlock} from './constants';\nimport {useActiveItemIndex, useQuickSearch} from './hooks';\nimport {getSelectFilteredOptions, useSelectOptions} from './hooks-public';\nimport {Option, OptionGroup} from './tech-components';\nimport type {SelectProps, SelectRenderPopup} from './types';\nimport type {SelectFilterRef} from './types-misc';\nimport {\n    findItemIndexByQuickSearch,\n    getActiveItem,\n    getListItems,\n    getOptionsFromChildren,\n    getSelectedOptionsContent,\n} from './utils';\nimport type {FlattenOption} from './utils';\n\nimport './Select.scss';\n\n//https://stackoverflow.com/a/58473012\ntype SelectComponent = (<T = any>(\n    p: SelectProps<T> & {ref?: React.Ref<HTMLButtonElement>},\n) => React.ReactElement) & {Option: typeof Option} & {OptionGroup: typeof OptionGroup};\n\nexport const DEFAULT_RENDER_POPUP: SelectRenderPopup = ({renderFilter, renderList}) => {\n    return (\n        <React.Fragment>\n            {renderFilter()}\n            {renderList()}\n        </React.Fragment>\n    );\n};\n\nexport const Select = React.forwardRef<HTMLButtonElement, SelectProps>(function Select<T = any>(\n    props: SelectProps<T>,\n    ref: React.Ref<HTMLButtonElement>,\n) {\n    const {\n        onUpdate,\n        onOpenChange,\n        onFilterChange,\n        renderControl,\n        renderFilter,\n        renderOption,\n        renderOptionGroup,\n        renderSelectedOption,\n        renderEmptyOptions,\n        renderPopup = DEFAULT_RENDER_POPUP,\n        getOptionHeight,\n        getOptionGroupHeight,\n        filterOption,\n        name,\n        form,\n        className,\n        controlClassName,\n        popupClassName,\n        qa,\n        value: propsValue,\n        defaultValue,\n        defaultOpen,\n        open: propsOpen,\n        label,\n        placeholder,\n        filterPlaceholder,\n        width,\n        popupWidth,\n        popupPlacement,\n        error,\n        virtualizationThreshold = DEFAULT_VIRTUALIZATION_THRESHOLD,\n        view = 'normal',\n        size = 'm',\n        pin = 'round-round',\n        multiple = false,\n        disabled = false,\n        filterable = false,\n        filter: propsFilter,\n        disablePortal,\n        hasClear = false,\n        onClose,\n        id,\n        hasCounter,\n        renderCounter,\n        title,\n    } = props;\n    const mobile = useMobile();\n    const [filter, setFilter] = useControlledState(propsFilter, '', onFilterChange);\n    // to avoid problem with incorrect popper offset calculation\n    // for example: https://github.com/radix-ui/primitives/issues/1567\n    const controlWrapRef = React.useRef<HTMLDivElement>(null);\n    const controlRef = React.useRef<HTMLElement>(null);\n    const filterRef = React.useRef<SelectFilterRef>(null);\n    const listRef = React.useRef<List<FlattenOption>>(null);\n    const handleControlRef = useForkRef(ref, controlRef);\n\n    const {value, open, toggleOpen, setValue, handleSelection, handleClearValue} = useSelect({\n        onUpdate,\n        value: propsValue,\n        defaultValue,\n        defaultOpen,\n        multiple,\n        open: propsOpen,\n        onClose,\n        onOpenChange,\n        disabled,\n    });\n\n    React.useEffect(() => {\n        if (!open && filterable && mobile) {\n            // FIXME: add handlers to Sheet like in https://github.com/gravity-ui/uikit/issues/1354\n            setTimeout(() => {\n                setFilter('');\n            }, 300);\n        }\n    }, [open, filterable, setFilter, mobile]);\n\n    const propsOptions = props.options || getOptionsFromChildren(props.children);\n    const options = useSelectOptions({\n        options: propsOptions,\n        filter,\n        filterable,\n        filterOption,\n    });\n    const filteredOptions = getSelectFilteredOptions(options) as FlattenOption[];\n    const selectedOptionsContent = getSelectedOptionsContent(options, value, renderSelectedOption);\n    const virtualized = filteredOptions.length >= virtualizationThreshold;\n\n    const {errorMessage, errorPlacement, validationState} = errorPropsMapper({\n        error,\n        errorMessage: props.errorMessage,\n        errorPlacement: props.errorPlacement || 'outside',\n        validationState: props.validationState,\n    });\n    const errorMessageId = useUniqId();\n\n    const isErrorStateVisible = validationState === 'invalid';\n    const isErrorMsgVisible =\n        isErrorStateVisible && Boolean(errorMessage) && errorPlacement === 'outside';\n    const isErrorIconVisible =\n        isErrorStateVisible && Boolean(errorMessage) && errorPlacement === 'inside';\n\n    const handleOptionClick = React.useCallback(\n        (option?: FlattenOption) => {\n            if (!option || option?.disabled || 'label' in option) {\n                return;\n            }\n\n            if (multiple) {\n                const activeItemIndex = listRef?.current?.getActiveItem();\n\n                if (!mobile) {\n                    filterRef.current?.focus();\n                }\n\n                if (typeof activeItemIndex === 'number') {\n                    // prevent item deactivation in case of multiple selection\n                    // https://github.com/gravity-ui/uikit/blob/main/src/components/List/List.tsx#L369\n                    // Will fixed after https://github.com/gravity-ui/uikit/issues/385\n                    setTimeout(() => {\n                        listRef?.current?.activateItem(activeItemIndex, true);\n                    }, 50);\n                }\n            }\n\n            handleSelection(option);\n        },\n        [handleSelection, mobile, multiple],\n    );\n\n    const handleControlKeyDown = React.useCallback(\n        (e: React.KeyboardEvent<HTMLElement>) => {\n            // prevent dialog closing in case of item selection by Enter/Spacebar keydown\n            if ([KeyCode.ENTER, KeyCode.SPACEBAR].includes(e.key) && open) {\n                e.preventDefault();\n\n                if (e.key === KeyCode.SPACEBAR) {\n                    handleOptionClick(getActiveItem(listRef));\n                }\n            }\n            if ([KeyCode.ARROW_DOWN, KeyCode.ARROW_UP].includes(e.key) && !open) {\n                e.preventDefault();\n                toggleOpen();\n            }\n            if (e.key === KeyCode.ESCAPE && open) {\n                toggleOpen(false);\n            }\n\n            listRef?.current?.onKeyDown(e);\n        },\n        [handleOptionClick, open, toggleOpen],\n    );\n\n    const handleFilterKeyDown = React.useCallback((e: React.KeyboardEvent<HTMLElement>) => {\n        listRef?.current?.onKeyDown(e);\n    }, []);\n\n    const handleQuickSearchChange = React.useCallback((search: string) => {\n        if (search) {\n            const itemIndex = findItemIndexByQuickSearch(search, getListItems(listRef));\n\n            if (typeof itemIndex === 'number' && itemIndex !== -1) {\n                listRef?.current?.activateItem(itemIndex, true);\n            }\n        }\n    }, []);\n\n    useQuickSearch({\n        onChange: handleQuickSearchChange,\n        open,\n        disabled: filterable,\n    });\n\n    const mods: CnMods = {\n        ...(width === 'max' && {width}),\n    };\n    const inlineStyles: React.CSSProperties = {};\n\n    if (typeof width === 'number') {\n        inlineStyles.width = width;\n    }\n\n    const handleClose = React.useCallback(() => toggleOpen(false), [toggleOpen]);\n    const {onFocus, onBlur} = props;\n    const {focusWithinProps} = useFocusWithin({\n        onFocusWithin: onFocus,\n        onBlurWithin: React.useCallback(\n            (e: React.FocusEvent) => {\n                onBlur?.(e);\n\n                if (!mobile) {\n                    handleClose();\n                }\n            },\n            [handleClose, mobile, onBlur],\n        ),\n    });\n\n    const uniqId = useUniqId();\n    const selectId = id ?? uniqId;\n    const popupId = `select-popup-${selectId}`;\n\n    const [activeIndex, setActiveIndex] = useActiveItemIndex({\n        options: filteredOptions,\n        open,\n        value,\n    });\n\n    const _renderFilter = () => {\n        if (filterable) {\n            return (\n                <SelectFilter\n                    ref={filterRef}\n                    size={size}\n                    value={filter}\n                    placeholder={filterPlaceholder}\n                    onChange={setFilter}\n                    onKeyDown={handleFilterKeyDown}\n                    renderFilter={renderFilter}\n                    popupId={popupId}\n                    activeIndex={activeIndex}\n                />\n            );\n        }\n\n        return null;\n    };\n\n    const _renderList = () => {\n        if (filteredOptions.length || props.loading) {\n            return (\n                <SelectList\n                    ref={listRef}\n                    size={size}\n                    value={value}\n                    mobile={mobile}\n                    flattenOptions={filteredOptions}\n                    multiple={multiple}\n                    virtualized={virtualized}\n                    onOptionClick={handleOptionClick}\n                    renderOption={renderOption}\n                    renderOptionGroup={renderOptionGroup}\n                    getOptionHeight={getOptionHeight}\n                    getOptionGroupHeight={getOptionGroupHeight}\n                    loading={props.loading}\n                    onLoadMore={props.onLoadMore}\n                    id={popupId}\n                    activeIndex={activeIndex}\n                    onChangeActive={setActiveIndex}\n                />\n            );\n        }\n\n        return <EmptyOptions filter={filter} renderEmptyOptions={renderEmptyOptions} />;\n    };\n\n    return (\n        <div\n            ref={controlWrapRef}\n            className={selectBlock(mods, className)}\n            {...focusWithinProps}\n            style={inlineStyles}\n            tabIndex={-1}\n        >\n            <SelectControl\n                {...filterDOMProps(props, {labelable: true})}\n                toggleOpen={toggleOpen}\n                hasClear={hasClear}\n                clearValue={handleClearValue}\n                ref={handleControlRef}\n                className={controlClassName}\n                qa={qa}\n                view={view}\n                size={size}\n                pin={pin}\n                label={label}\n                placeholder={placeholder}\n                selectedOptionsContent={selectedOptionsContent}\n                isErrorVisible={isErrorStateVisible}\n                errorMessage={isErrorIconVisible ? errorMessage : undefined}\n                open={open}\n                disabled={disabled}\n                onKeyDown={handleControlKeyDown}\n                renderControl={renderControl}\n                value={value}\n                popupId={popupId}\n                selectId={selectId}\n                activeIndex={activeIndex}\n                hasCounter={multiple && hasCounter}\n                renderCounter={renderCounter}\n                title={title}\n            />\n            <SelectPopup\n                ref={controlWrapRef}\n                className={popupClassName}\n                controlRef={controlRef}\n                width={popupWidth}\n                open={open}\n                handleClose={handleClose}\n                disablePortal={disablePortal}\n                virtualized={virtualized}\n                mobile={mobile}\n                placement={popupPlacement}\n                onAfterOpen={\n                    filterable\n                        ? () => {\n                              filterRef.current?.focus();\n                          }\n                        : undefined\n                }\n                onAfterClose={\n                    filterable\n                        ? () => {\n                              setFilter('');\n                          }\n                        : undefined\n                }\n            >\n                {renderPopup({renderFilter: _renderFilter, renderList: _renderList})}\n            </SelectPopup>\n            <OuterAdditionalContent\n                errorMessage={isErrorMsgVisible ? errorMessage : null}\n                errorMessageId={errorMessageId}\n            />\n            <HiddenSelect\n                name={name}\n                value={value}\n                disabled={disabled}\n                form={form}\n                onReset={setValue}\n            />\n        </div>\n    );\n}) as unknown as SelectComponent;\n\nSelect.Option = Option;\nSelect.OptionGroup = OptionGroup;\n"]}